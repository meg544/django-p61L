{% extends "base.html" %}
{% load formatos %}
{% block content %}

<h2>Gastos del proveedor: {{ proveedor.nombre }}</h2>

<p><strong>Total: </strong> {{ total|formato_pesos }}</p>

<button type="button" class="btn btn-primary" onclick="imprimirSeleccionados()">
    Imprimir Seleccionados
</button>

<script>
function seleccionarTodo(source) {
    let checkboxes = document.getElementsByName('gastos_seleccionados');
    for (let i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
    }
}

function imprimirSeleccionados() {
    let seleccionados = document.querySelectorAll('input[name="gastos_seleccionados"]:checked');

    if (seleccionados.length === 0) {
        alert("Por favor selecciona al menos un gasto para imprimir.");
        return;
    }

    let folios = [];
    seleccionados.forEach((checkbox) => {
        folios.push(checkbox.value);
    });

    let base_url = "{% url 'generar_pdf_multiple2' %}";
    let url = base_url + "?folios=" + folios.join(",");
    window.open(url, "_blank");
}
</script>

<style>
    #customers {
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

    #customers td, #customers th {
        border: 1px solid #ddd;
        padding: 8px;
        vertical-align: top;
    }

    #customers tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    #customers tr:hover {
        background-color: #ddd;
    }

    #customers th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #f8f9fa;
    }

    /* ðŸ”¥ Hace que comentarios no crezcan demasiado */
    .comentarios-col {
        max-width: 250px;      /* ancho fijo */
        white-space: normal;   /* permite saltos */
        word-wrap: break-word; /* corta palabras largas */
        overflow-wrap: break-word;
    }
</style>

<table id="customers">
    <thead>
    <tr>
        <th><input type="checkbox" onclick="seleccionarTodo(this)"></th>
        <th>Folio</th>
        <th>Fecha</th>
        <th>Evento</th>
        <th>Importe</th>
        <th>Tipo Movimiento</th>
        <th>Comentarios</th>
        <th>Acciones</th>
    </tr>
    </thead>

    <tbody>
    {% for gasto in gastos %}
    <tr>
        <td><input type="checkbox" name="gastos_seleccionados" value="{{ gasto.folio }}"></td>
        <td>{{ gasto.folio }}</td>
        <td>{{ gasto.fecha|date:"d/m/Y" }}</td>
        <td>{{ gasto.evento.nombre }}</td>
        <td>{{ gasto.importe|formato_pesos }}</td>
        <td>{{ gasto.concepto }}</td>

        <!-- ðŸ”¥ Comentarios controlado -->
        <td class="comentarios-col">
            {{ gasto.comentarios }}
        </td>

        <td>
            <a href="{% url 'editar_gasto' gasto.pk %}" class="btn btn-sm btn-warning">
                Editar
            </a>

            <a href="{% url 'generar_pdf' gasto.folio %}"
               class="btn btn-sm btn-secondary"
               target="_blank">
                Imprimir
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
